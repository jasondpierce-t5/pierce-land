---
phase: 02-admin-auth
plan: 01
type: execute
depends_on: []
files_modified: [middleware.ts, .env.local, src/app/admin/login/page.tsx, src/app/api/admin/auth/route.ts, src/app/admin/layout.tsx, src/app/admin/page.tsx]
---

<objective>
Create password-protected admin dashboard with authentication middleware and navigation structure.

Purpose: Enable secure access to admin interface for managing shared financials and bank versions
Output: Functional login system and admin dashboard layout ready for feature development
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-database/01-01-SUMMARY.md
@.planning/phases/01-foundation-database/01-02-SUMMARY.md
@src/app/layout.tsx
@src/lib/supabase.ts

**Tech stack available:** Next.js 14 App Router, TypeScript, Tailwind CSS, Supabase client
**Established patterns:**
- Tailwind color system: bg-primary (#1a3a2a), text-accent (#c4872a), text-green (#3a7d53)
- Inter font loaded via next/font/google with CSS variable
- Simple Supabase client pattern in src/lib/supabase.ts

**Constraining decisions:**
- [Phase 1]: Simple password authentication (no user accounts, no OAuth) - single-operator use case
- [Phase 1]: Database schema ready (plan_config and plan_versions tables)
- [PROJECT.md]: Professional presentation matching existing visual artifact

**Issues being addressed:** None
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create authentication middleware for admin routes</name>
  <files>middleware.ts, .env.local</files>
  <action>Create Next.js middleware that intercepts all /admin/* routes (except /admin/login). Check for 'admin_auth' httpOnly cookie. If present, allow request. If missing, redirect to /admin/login. Add ADMIN_PASSWORD to .env.local (use strong password). Middleware should use Next.js 14 middleware pattern with matcher config targeting /admin paths. Use NextResponse.redirect() for redirects and NextResponse.next() to allow through.</action>
  <verify>middleware.ts exists with matcher for /admin paths, .env.local contains ADMIN_PASSWORD (not committed)</verify>
  <done>Middleware intercepts /admin routes correctly, authenticated requests pass through, unauthenticated redirect to login</done>
</task>

<task type="auto">
  <name>Task 2: Create login page with password verification API</name>
  <files>src/app/admin/login/page.tsx, src/app/api/admin/auth/route.ts</files>
  <action>Create login page at /admin/login with password form (single input, no username needed). Form submits to POST /api/admin/auth. API route validates password against ADMIN_PASSWORD env var. On success: set httpOnly cookie 'admin_auth=authenticated' with 30-day expiry, return {success: true}. On failure: return 401 with {error: 'Invalid password'}. Use Next.js cookies() from next/headers to set cookie. Login page shows error on failure, redirects to /admin on success. Style with brand colors (bg-primary background, text-accent for button, Inter font). Keep form simple and professional.</action>
  <verify>Login page accessible at /admin/login, API route responds to POST with proper status codes</verify>
  <done>Valid password sets cookie and redirects to /admin, invalid password shows error, professional appearance</done>
</task>

<task type="auto">
  <name>Task 3: Create admin dashboard layout and home page</name>
  <files>src/app/admin/layout.tsx, src/app/admin/page.tsx</files>
  <action>Create admin layout with navigation sidebar/header containing links: "Dashboard" (/admin), "Shared Config" (/admin/config), "Bank Versions" (/admin/banks). Use bg-primary (#1a3a2a) for navigation background, text-white for nav text, text-accent (#c4872a) for active/hover states. Include "Logout" button that calls DELETE /api/admin/auth to clear cookie and redirect to /admin/login. Admin home page shows "Pierce Land & Cattle Admin Dashboard" heading and brief description of admin functions (placeholder content). Keep layout simple and professional - responsive mobile menu can come later.</action>
  <verify>Admin layout renders at /admin with visible navigation, home page displays welcome content</verify>
  <done>Navigation structure complete with functional links, logout clears auth, professional appearance matching brand identity</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Password-protected admin dashboard with complete authentication flow and navigation structure</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/admin (should auto-redirect to /admin/login)
    3. Enter wrong password: Verify error message appears
    4. Enter correct password from .env.local: Verify redirect to /admin dashboard
    5. Check navigation: Verify "Dashboard", "Shared Config", "Bank Versions" links visible
    6. Click "Logout": Verify redirect to login page
    7. Try accessing /admin again: Verify redirect to login (auth cleared)
    8. Confirm: Professional appearance with brand colors (#1a3a2a, #c4872a)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npm run build succeeds without TypeScript errors
- [ ] Authentication flow works end-to-end (login → dashboard → logout)
- [ ] Admin dashboard renders with navigation structure
- [ ] Brand colors applied correctly throughout
- [ ] Middleware protects admin routes properly
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Authentication middleware protects /admin routes except /admin/login
- Login page validates password and sets secure httpOnly cookie
- Admin dashboard has navigation for upcoming features (Shared Config, Bank Versions)
- Logout functionality clears authentication
- Professional appearance matching brand identity
- Phase 2 complete - ready for Phase 3 (Shared Config Management)
</success_criteria>

<output>
After completion, create `.planning/phases/02-admin-auth/02-01-SUMMARY.md`:

# Phase 2 Plan 01: Admin Authentication & Dashboard Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `file.ts` - Description
- `file.tsx` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 2 complete, ready for Phase 3: Shared Config Management
</output>
