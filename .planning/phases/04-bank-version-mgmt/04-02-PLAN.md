---
phase: 04-bank-version-mgmt
plan: 02
type: execute
depends_on: ["04-01"]
files_modified: [src/app/admin/versions/page.tsx, src/app/admin/versions/new/page.tsx, src/app/admin/versions/[id]/edit/page.tsx]
---

<objective>
Create admin UI for managing bank versions with list view, create form, and edit form.

Purpose: Enable admin to visually manage all bank versions through professional interface with status indicators and override controls.
Output: Complete admin interface for bank version management.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-shared-config-mgmt/03-01-SUMMARY.md
@.planning/phases/04-bank-version-mgmt/04-01-SUMMARY.md
@src/app/admin/config/page.tsx
@src/app/admin/layout.tsx
@src/lib/utils.ts

**Tech stack available:** Next.js 14, TypeScript, Tailwind CSS, Supabase client
**Established patterns:**
- Form pattern: controlled inputs with useState, loading states, success/error messaging (from 03-01)
- Tailwind color system: bg-primary (#1a3a2a), text-accent (#c4872a), focus ring-accent (from 01-01)
- Professional form layout: fieldset/legend for sections, labels with units, grid layout (from 03-01)
- Client-side validation before API calls (from 03-01)

**Constraining decisions:**
- Override pattern: null = use default, show default value in UI with "Use default" option (from 01-02)
- Slug auto-generation from bank_name with manual override capability (from 01-02)
- Simplified password for admin (no complex auth) (from 02-01)

**API endpoints available (from 04-01):**
- GET /api/admin/versions - list all
- POST /api/admin/versions - create new
- PATCH /api/admin/versions/[id] - update
- DELETE /api/admin/versions/[id] - soft delete (sets is_active=false)

**Slug generation utility available:** generateSlug(text: string) in src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bank versions list page</name>
  <files>src/app/admin/versions/page.tsx</files>
  <action>
Create src/app/admin/versions/page.tsx as a client component ('use client') with:

**Data fetching:**
- useEffect to fetch GET /api/admin/versions on mount
- useState for versions array, loading, error states
- Display loading spinner during fetch
- Display error message if fetch fails

**Table layout:**
- Professional table with headers: Bank Name, Slug, Status, Overrides, Actions
- Each row shows:
  - bank_name
  - slug (monospace font for clarity)
  - Status badge: Green "Active" or gray "Inactive" based on is_active
  - Overrides column: show count of non-null override fields (e.g., "2 custom values" or "Using defaults")
  - Actions: "Edit" link (to /admin/versions/[id]/edit) and "Deactivate" button (only for active versions)
- "Create New Bank Version" button at top (links to /admin/versions/new)

**Deactivate functionality:**
- Confirmation dialog before deactivate: "Deactivate [bank_name]? This will make the plan unavailable publicly."
- On confirm, DELETE /api/admin/versions/[id] (soft delete)
- Refresh list after successful deactivation
- Show success message "Version deactivated successfully"

**Styling:**
- Match admin dashboard aesthetic (Tailwind with brand colors)
- Table: border, striped rows on hover
- Status badges: rounded-full px-2 py-1 text-xs font-semibold
- Active badge: bg-green-100 text-green-800
- Inactive badge: bg-gray-100 text-gray-800
- Action buttons: text-accent hover:underline for Edit, text-red-600 hover:underline for Deactivate

**Empty state:**
- If no versions exist, show message: "No bank versions yet. Create your first one to get started."
  </action>
  <verify>
Start dev server (npm run dev), navigate to /admin/versions:
- List displays all versions from seed data (3 sample banks)
- Status badges show correct active/inactive state
- Override count displays correctly
- Edit links navigate to /admin/versions/[id]/edit
- Deactivate button shows confirmation, updates database, refreshes list
- Create button links to /admin/versions/new
  </verify>
  <done>List page renders all versions, status indicators work, deactivate function works, navigation to create/edit works</done>
</task>

<task type="auto">
  <name>Task 2: Create bank version form pages (new and edit)</name>
  <files>src/app/admin/versions/new/page.tsx, src/app/admin/versions/[id]/edit/page.tsx</files>
  <action>
Create two pages that share the same form logic:

**File 1: src/app/admin/versions/new/page.tsx** (Create mode)
- Form for creating new bank version
- Auto-generate slug from bank_name as user types (using generateSlug utility)
- Allow manual slug override (editable text input, pre-filled with auto-generated value)
- Show real-time slug preview below bank_name field

**File 2: src/app/admin/versions/[id]/edit/page.tsx** (Edit mode)
- Fetch existing version data on mount using GET /api/admin/versions (filter by id client-side)
- Pre-fill all form fields with existing values
- Same form structure as create mode

**Form fields:**
1. **Bank Name** (required text input)
   - Label: "Bank Name"
   - Placeholder: "e.g., First National Bank"
   - Auto-generate slug on change (create mode)
   - Validation: required, min 1 char, max 255 chars

2. **Slug** (required text input)
   - Label: "URL Slug"
   - Help text: "Auto-generated from bank name. Edit if needed."
   - Validation: required, lowercase, hyphens only, no spaces
   - Show validation error if format is invalid

3. **Override Fields** (optional, organized in fieldset)
   - Legend: "Custom Values (Optional - leave blank to use defaults)"
   - For each override field, show two inputs:

     **Line of Credit:**
     - Checkbox: "Use custom line of credit"
     - Number input (visible only if checked): "Line of Credit ($)" - numeric, positive validation
     - Help text when unchecked: "Using default: $500,000" (fetch default from plan_config)

     **Interest Rate:**
     - Checkbox: "Use custom interest rate"
     - Number input (visible only if checked): "Interest Rate (%)" - numeric, 0-100 validation
     - Help text when unchecked: "Using default: 7.5%" (fetch default from plan_config)

     **Total Head Count:**
     - Checkbox: "Use custom head count"
     - Number input (visible only if checked): "Total Head" - integer, positive validation
     - Help text when unchecked: "Using default: 250 head" (fetch default from plan_config)

**Form behavior:**
- Controlled inputs with useState for all fields
- Client-side validation before submit
- On submit:
  - Create mode: POST /api/admin/versions with form data
  - Edit mode: PATCH /api/admin/versions/[id] with form data
  - Send null for unchecked override fields (use default)
- Success: redirect to /admin/versions with success message in URL params
- Error: display error message above form
- Cancel button: navigate back to /admin/versions

**Styling:**
- Match config page style (from Phase 3)
- Grid layout for form fields (2 columns on desktop)
- Professional spacing and borders
- Brand colors for focus states (ring-accent)
- Override checkboxes toggle visibility of number inputs (conditional rendering)

**Default values fetch:**
- On mount, fetch GET /api/admin/config to get default values
- Display these defaults in help text for each override field
- If config fetch fails, show generic help text without specific numbers
  </action>
  <verify>
Test both pages:
- /admin/versions/new:
  - Type bank name, see slug auto-generate in real-time
  - Edit slug manually to customize
  - Toggle override checkboxes, see inputs appear/disappear
  - Submit with valid data, redirects to list with new version visible
  - Submit with invalid slug format, see validation error
- /admin/versions/[id]/edit with existing version ID:
  - Form pre-fills with existing data
  - Override checkboxes checked if override values exist
  - Update fields and save, see changes in list
  - Cancel returns to list without saving
  </verify>
  <done>Both create and edit forms work, slug generation works, override toggles work, validation prevents bad data, redirects work correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] List page displays all versions with correct status badges
- [ ] Create form generates slugs automatically from bank names
- [ ] Edit form pre-fills with existing data
- [ ] Override toggles show/hide inputs correctly
- [ ] Default values displayed in help text
- [ ] Deactivate function works with confirmation
- [ ] All navigation links work (list ↔ create ↔ edit)
- [ ] Form validation prevents invalid submissions
- [ ] Success/error messages display appropriately
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- UI matches established admin dashboard aesthetic
- No TypeScript errors
- Forms follow established patterns from Phase 3
- Phase 4 complete - bank version management fully functional
  </success_criteria>

<output>
After completion, create `.planning/phases/04-bank-version-mgmt/04-02-SUMMARY.md`:

# Phase 4 Plan 02: Bank Version Admin UI Summary

**Professional admin interface for managing bank versions with list, create, and edit views**

## Accomplishments

- [Key outcomes from implementation]

## Files Created/Modified

- [List all files with descriptions]

## Decisions Made

[Document any implementation decisions, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

**Phase 4 complete. Ready for Phase 5: Financial Calculations Engine**

- Bank version CRUD fully functional
- Admin can create, edit, and deactivate bank versions
- Override mechanism working (null = use default)
- Slug generation automatic with manual override capability
- Professional UI matches dashboard aesthetic
- No blockers for Phase 5 work
</output>
