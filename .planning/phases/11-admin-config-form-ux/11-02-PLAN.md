---
phase: 11-admin-config-form-ux
plan: 02
type: execute
depends_on: ["11-01"]
files_modified: [src/app/admin/config/page.tsx]
---

<objective>
Polish field labels, add contextual help text, and implement dirty state tracking so the operator can quickly see what changed before saving.

Purpose: With 43 fields, it's easy to lose track of which values were modified. Clearer labels and help text reduce errors when updating market data.
Output: Improved field labels, help text on key fields, changed-field highlighting, unsaved changes warning.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-admin-config-form-ux/11-01-SUMMARY.md

@src/app/admin/config/page.tsx

**Tech stack available:** Next.js 14, Tailwind CSS, React useState
**Established patterns:** controlled-forms, NumberInput/TextInput components, brand colors
**Constraining decisions:**
- [Phase 3]: Controlled inputs with useState, cancel resets to saved state
- [Phase 11-01]: Collapsible accordion sections with descriptions, sticky save bar
</context>

<tasks>

<task type="auto">
  <name>Task 1: Improve field labels and add help text</name>
  <files>src/app/admin/config/page.tsx</files>
  <action>
1. **Update the NumberInput and TextInput components** to accept an optional `description` prop (string). When provided, render it as `<p className="text-xs text-gray-400 mt-0.5">{description}</p>` below the label, above the input.

2. **Improve labels and add descriptions** for fields that benefit from context. Only add descriptions where the label alone is ambiguous — don't clutter obvious fields. Key improvements:

   **Market Prices & Scenarios:**
   - "Purchase Price (Mid)" → label: "Purchase Price (Mid)", description: "Current market price per cwt for 500lb feeder heifers"
   - "Sale Price (Mid)" → label: "Sale Price (Mid)", description: "Expected sale price per cwt for finished 850lb heifers"
   - "Sale Price Low" → description: "Conservative scenario price for sensitivity analysis"
   - "Sale Price High" → description: "Optimistic scenario price for sensitivity analysis"

   **Operational Parameters:**
   - "Average Daily Gain" → description: "Expected weight gain per head per day on feed"
   - "Mortality Rate" → description: "Annual expected loss percentage across the herd"

   **Spring/Winter Turn Costs:**
   - "LRP Premium" → description: "Livestock Risk Protection insurance premium"
   - "Marketing Commission" → description: "Sale barn or direct marketing fees"

   **Winter Feed Details:**
   - "Hay Waste" → description: "Expected loss percentage from feeding and storage"
   - "Daily Commodity Intake" → description: "Pounds of commodity feed per head per day"

   **Financial Defaults:**
   - "Line of Credit" → description: "Default LOC amount — can be overridden per bank version"
   - "Head Count" → description: "Default herd size — can be overridden per bank version"
   - "Interest Rate" → description: "Default LOC interest rate — can be overridden per bank version"

3. **Do NOT add descriptions to every field** — self-explanatory fields like "Operator Name", "Acres", "Health Cost", "Freight In" etc. don't need them.
  </action>
  <verify>npm run build passes without errors. Dev server shows help text under labeled fields. Text is subtle (text-xs text-gray-400) and doesn't clutter the layout.</verify>
  <done>NumberInput/TextInput support optional description prop. ~13 fields have contextual help text. Labels are clear and descriptions explain non-obvious fields.</done>
</task>

<task type="auto">
  <name>Task 2: Add dirty state tracking and unsaved changes indicator</name>
  <files>src/app/admin/config/page.tsx</files>
  <action>
1. **Changed field highlighting:** Compare `formData` against `savedData` for each field. When a field's value differs from its saved value, add a visual indicator:
   - Add a `ring-2 ring-accent/30` class to the input wrapper (the input element itself) for changed fields
   - This gives a subtle amber ring around modified fields

2. **Dirty state detection:** Create a `useMemo` or derived variable `isDirty` that returns `true` if any field in `formData` differs from `savedData`. Compare all fields — for numbers use strict equality, for strings use trimmed equality.

3. **Unsaved changes count in sticky bar:** When `isDirty` is true, show a small badge or text in the sticky bar like "N field(s) changed" to the left of the cancel button. Use `text-sm text-accent font-medium`. When no changes, show nothing (or "No unsaved changes" in gray).

4. **Update section headers with change count:** In each accordion section header, when that section has dirty fields, show a small badge like `(2 changed)` next to the section description in `text-xs text-accent font-medium`. This helps identify which sections have modifications without opening them.

5. **Browser beforeunload warning:** Add a `useEffect` that listens for the `beforeunload` event when `isDirty` is true. Show the browser's native "You have unsaved changes" dialog. Remove the listener when `isDirty` is false or on unmount.

Do NOT change save/cancel logic, validation, or form submission behavior.
  </action>
  <verify>npm run build passes. Dev server: change a field value → field gets amber ring, sticky bar shows "1 field(s) changed", section header shows "(1 changed)". Save → indicators clear. Cancel → indicators clear. Try to navigate away with unsaved changes → browser shows warning.</verify>
  <done>Changed fields highlighted with accent ring. Sticky bar shows change count. Section headers show per-section change count. Browser warns on navigation with unsaved changes. All indicators clear on save or cancel.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Improved field labels with help text and dirty state tracking with visual indicators across the config form</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/admin/config
    3. Check that key fields have subtle help text below labels (e.g., "Purchase Price" shows cwt description)
    4. Change a few field values — verify amber ring appears on changed inputs
    5. Check sticky bar shows change count (e.g., "3 field(s) changed")
    6. Check section headers show change count badges
    7. Save — verify all indicators clear
    8. Change a value, then click Cancel — verify indicators clear
    9. Change a value, try closing the tab — verify browser unsaved changes warning
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Help text visible on ~13 key fields
- [ ] Changed fields get accent ring highlight
- [ ] Sticky bar shows unsaved change count
- [ ] Section headers show per-section change count
- [ ] Browser warns on navigation with dirty state
- [ ] Save and cancel clear all dirty indicators
- [ ] No TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Config form provides clear editing feedback with labels, help text, and dirty state
- Phase 11 complete
</success_criteria>

<output>
After completion, create `.planning/phases/11-admin-config-form-ux/11-02-SUMMARY.md`
</output>
