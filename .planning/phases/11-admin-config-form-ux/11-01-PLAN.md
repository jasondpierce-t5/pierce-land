---
phase: 11-admin-config-form-ux
plan: 01
type: execute
depends_on: []
files_modified: [src/app/admin/config/page.tsx]
---

<objective>
Redesign the admin config form with collapsible sections, field descriptions, improved labels, and a better editing flow.

Purpose: The config form has 43+ fields across 8 sections displayed as one long scroll. Frequently-changed market prices are mixed with rarely-changed operational parameters. No field descriptions explain what values mean (e.g., "LRP Premium" is unexplained). The save button is buried at the bottom. This redesign makes the form faster to navigate and easier to understand.

Output: Polished config form with collapsible accordion sections, descriptive helper text, sticky save bar, and unsaved changes detection.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-shared-config-mgmt/03-01-SUMMARY.md

# Key files:
@src/app/admin/config/page.tsx

**Tech stack:** Next.js 14 (App Router), Tailwind CSS, React useState/useEffect
**Established patterns:** Controlled forms, fieldset/legend for sections, grid layout, accent color for focus states, inline validation errors
**Constraining decisions:**
- Phase 3: Four-section form organization with fieldset/legend — expanding to 8 sections with collapsible UI
- Phase 3: Client-side validation with field-level errors — keep this pattern intact
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add collapsible accordion sections with field descriptions</name>
  <files>src/app/admin/config/page.tsx</files>
  <action>
Refactor the config form to use collapsible accordion sections. Each section header should be clickable to expand/collapse its content. Use React state to track which sections are open (default: first 3 sections open, the rest collapsed — since Operator Info, Market Prices, and Feed Costs are most frequently accessed).

**Accordion behavior:**
- Click section header to toggle open/closed
- Chevron icon rotates to indicate state (down = closed, up = open)
- Smooth height transition using CSS (max-height + overflow hidden + transition)
- Multiple sections can be open simultaneously (not mutually exclusive)

**Section descriptions** — Add a brief description below each section legend explaining what the section controls:
- Operator Information: "Basic details about your operation that appear on bank plan cover pages"
- Market Prices and Scenarios: "Current cattle purchase and sale prices used to calculate profitability across low/mid/high scenarios"
- Feed Costs: "General feed costs used in spring turn calculations"
- Operational Parameters: "Purchase and sale weights, daily gain, and mortality assumptions for projections"
- Spring Turn Costs: "Per-head costs for the spring grazing turn (typically March-September)"
- Winter Turn Costs: "Per-head costs for the winter feeding turn (typically October-February)"
- Winter Feed Details: "Hay and commodity feed pricing, intake rates, and waste factors for winter cost calculations"
- Financial Defaults: "Default interest rate, line of credit, and head count — bank versions can override these"

**Field-level helper text** — Add brief descriptions below these fields that use industry jargon:
- LRP Premium: "Livestock Risk Protection insurance premium"
- Marketing Commission: "Sale barn or auction commission fee"
- Commodity Price: "Supplemental feed (grain/pellets) price"
- Commodity Daily Intake: "Pounds of supplement fed per head per day"
- Hay Waste: "Percentage lost to weather, trampling, spoilage"
- Mortality Rate: "Expected annual death loss across all causes"
- AVG Daily Gain: "Expected average daily weight gain per head"

**Implementation notes:**
- Keep the existing NumberInput and TextInput components — add an optional `description` prop that renders as small gray text below the input, above the error message
- Create a CollapsibleSection component that wraps each fieldset with click-to-toggle behavior
- Use a `Set<string>` in state to track which sections are open by section name
- Preserve all existing validation logic — do NOT modify handleChange, validateForm, or handleSubmit
- Do NOT modify the API route (src/app/api/admin/config/route.ts)
  </action>
  <verify>npm run build succeeds without errors. Open the config page in dev server — all 8 sections render with descriptions, sections collapse/expand on click, all 43+ fields are still present and functional.</verify>
  <done>All 8 sections are collapsible with section descriptions. Field-level helper text appears on jargon fields. First 3 sections default to open. Chevron icons animate. Validation still works. No TypeScript errors.</done>
</task>

<task type="auto">
  <name>Task 2: Add sticky save bar and unsaved changes indicator</name>
  <files>src/app/admin/config/page.tsx</files>
  <action>
Replace the bottom-fixed form actions with a sticky save bar that remains visible while scrolling:

**Sticky save bar:**
- Position: sticky bottom-0 with white background and top border/shadow
- Contains: Cancel button, Save button, and unsaved changes indicator
- Always visible regardless of scroll position
- On mobile: buttons side-by-side at full width
- Background uses slight shadow (`shadow-[0_-2px_10px_rgba(0,0,0,0.05)]`) to distinguish from form content

**Unsaved changes detection:**
- Compare current formData against savedData using JSON.stringify comparison
- When changes detected: show a small amber/yellow dot or text "Unsaved changes" next to the Save button
- When no changes: Save button shows as "Saved" (disabled, muted style) instead of "Save Configuration"
- After successful save: briefly flash green "Saved!" before reverting to disabled state (use setTimeout ~2s)

**Visual polish:**
- Increase section header padding slightly for better click targets on accordion
- Ensure grid gap and field spacing is consistent across all sections
- Add subtle hover effect on section headers (slight background color change on hover)
- Ensure the collapsed state is clean — no layout shift when toggling

**Implementation notes:**
- The sticky bar should be inside the form element so the submit button still works
- Use Tailwind `sticky bottom-0` with appropriate z-index to stay above content
- Use useMemo to compute hasChanges by comparing formData vs savedData to avoid unnecessary re-renders
- Do NOT change any validation logic or API calls
  </action>
  <verify>npm run build succeeds. Scroll the config page — save bar stays visible at bottom. Change a field value — "Unsaved changes" indicator appears. Save — indicator disappears and shows "Saved!" briefly. Cancel — form resets and indicator disappears.</verify>
  <done>Sticky save bar visible at all scroll positions. Unsaved changes indicator works correctly (appears on change, disappears on save/cancel). Section headers have hover effects. No layout shift on accordion toggle. Build passes with no errors.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] All 43+ config fields still render and accept input
- [ ] All 8 sections collapse and expand correctly
- [ ] Section descriptions and field helper text display properly
- [ ] Validation still works (try submitting with empty required field)
- [ ] Sticky save bar remains visible while scrolling
- [ ] Unsaved changes indicator appears/disappears correctly
- [ ] Cancel resets form and clears unsaved indicator
- [ ] Save persists data and shows confirmation
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- Config form is significantly easier to navigate with collapsible sections
- Field descriptions help explain jargon terms
- Sticky save bar eliminates scroll-to-bottom friction
- Unsaved changes indicator prevents accidental data loss
</success_criteria>

<output>
After completion, create `.planning/phases/11-admin-config-form-ux/11-01-SUMMARY.md`
</output>
