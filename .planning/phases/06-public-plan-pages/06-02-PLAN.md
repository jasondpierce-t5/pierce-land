---
phase: 06-public-plan-pages
plan: 02
type: execute
---

<objective>
Build the core financial detail sections of the business plan: operation overview, spring turn table, winter turn table, annual projections, and credit structure.

Purpose: Display the detailed financial data that bankers need to evaluate the stocker heifer operation.
Output: Five professional business plan sections rendering real calculated data with proper formatting.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-public-plan-pages/06-01-SUMMARY.md
@src/app/plan/[slug]/page.tsx
@src/lib/types.ts
@src/lib/calculations.ts
@src/lib/formatters.ts
@src/lib/plan-data.ts

**Established patterns:** Tailwind branded colors (primary #1a3a2a, accent #c4872a, green #3a7d53), formatCurrency/formatPercent/formatWeight/formatCwt helpers, section containers with space-y-8 spacing

**Constraining decisions:**
- No rounding at calculation level — formatters handle display precision (from 05-02)
- All calculation functions pure — data available as props (from 05-02)
- Professional presentation for bankers — clean, polished tables (from PROJECT.md)
- Spring/winter turn configs have per-head cost fields (health, freight, mineral, etc.) — from 05-01
- Division-by-zero guards return 0 for costOfGain when applicable — from 05-02
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Operation Overview section</name>
  <files>src/app/plan/[slug]/page.tsx</files>
  <action>
Add the Operation Overview section after the KPI row in page.tsx (replace or insert after the placeholder comment).

**Operation Overview section:**
- Section heading: h2 with "Operation Overview", styled with border-l-4 border-accent pl-4 text-2xl font-bold text-gray-900
- Two-column grid layout (grid md:grid-cols-2 gap-6)
- Wrap in white card: bg-white shadow-sm rounded-lg p-6

Left column — "Operator Details" (h3 text-lg font-semibold text-gray-700 mb-3):
- Operator: {config.operator_name}
- Location: {config.operation_location}
- Experience: {config.years_experience} years
- Acreage: {config.acres} acres

Right column — "Operation Parameters" (h3 text-lg font-semibold text-gray-700 mb-3):
- Head Count: {config.head_count} formatNumber
- Purchase Weight: {config.purchase_weight_lbs} formatWeight
- Target Sale Weight: {config.sale_weight_lbs} formatWeight
- Avg Daily Gain: {config.avg_daily_gain_lbs} lbs/day
- Interest Rate: {config.interest_rate_pct} formatPercent
- Line of Credit: {config.loc_amount} formatCurrencyWhole

Each row: flex justify-between with label in text-gray-600 and value in font-medium text-gray-900. Rows separated by border-b border-gray-100 py-2.

Establish a consistent section spacing pattern (e.g., wrap each major section in a div with consistent margin) so subsequent sections added in this plan and Plan 06-03 maintain even spacing throughout the page.
  </action>
  <verify>npm run build passes. Dev server shows Operation Overview with real operator data below KPI row.</verify>
  <done>Operation Overview section renders operator details and operation parameters in professional two-column layout with consistent row styling</done>
</task>

<task type="auto">
  <name>Task 2: Add Spring Turn and Winter Turn financial detail tables</name>
  <files>src/app/plan/[slug]/page.tsx</files>
  <action>
Add Spring Turn and Winter Turn sections after Operation Overview.

**Create inline helper components (within page.tsx, not separate files):**
- TableRow: label + value row with optional indent level and bold flag
- SubtotalRow: emphasized subtotal with border-t
- TotalRow: bold, larger text, bg-gray-50 or accent-tinted row
- These are just small function components to reduce repetition

**Spring Turn section:**
- Section heading: "Spring Turn — Per Head Analysis" with accent border-l-4
- White card container
- Financial table with single-column layout (label left-aligned, value right-aligned):

  **Purchase:**
  - Purchase Weight: config.purchase_weight_lbs formatWeight
  - Purchase Price: config.market_price_500lb formatCwt
  - Purchase Cost: spring.purchaseCost formatCurrency

  **Carrying Costs:** (indent these rows)
  - Interest Cost: spring.interestCost formatCurrency
  - Death Loss: spring.deathLoss formatCurrency
  - Health: config.spring_health_cost_per_head formatCurrency
  - Freight In: config.spring_freight_in_per_head formatCurrency
  - Mineral: config.spring_mineral_per_head formatCurrency
  - LRP Premium: config.spring_lrp_premium_per_head formatCurrency
  - Marketing/Commission: config.spring_marketing_commission_per_head formatCurrency
  - Freight Out: config.spring_freight_out_per_head formatCurrency
  - Miscellaneous: config.spring_misc_per_head formatCurrency
  - **Subtotal Carrying Costs: spring.carryingCosts formatCurrency** (SubtotalRow)

  **Total Investment: spring.totalInvestment formatCurrency** (bold subtotal)

  **Sale:**
  - Sale Weight: config.spring_sale_weight_lbs formatWeight (use spring-specific if exists, else sale_weight_lbs)
  - Days on Feed: spring.daysOnFeed
  - Weight Gain: spring.weightGain formatWeight
  - Gross Revenue: spring.grossRevenue formatCurrency

  **Net Income: spring.netIncome formatCurrency** (TotalRow — green if positive, red if negative)
  - Cost of Gain: spring.costOfGain formatCwt

**Winter Turn section:**
- Same structure as Spring Turn with winter.* values and config.winter_* fields
- Additional "Feed Costs" sub-section within carrying costs:
  - Hay Cost: winter.hayCost formatCurrency (note: {winter.hayConsumed} lbs consumed)
  - Hay Waste: winter.hayWaste lbs
  - Commodity Cost: winter.commodityCost formatCurrency
  - **Total Feed Cost: winter.totalFeedCost formatCurrency** (SubtotalRow)

Table styling: Rows with py-2 px-4, alternating backgrounds optional (even:bg-gray-50), clear visual hierarchy distinguishing regular rows from subtotals from the final total. Consistent with professional financial statement formatting.
  </action>
  <verify>npm run build passes. Both turn tables render with complete financial breakdowns and proper formatting. Net income row shows green/red coloring.</verify>
  <done>Spring Turn and Winter Turn sections show complete per-head financial breakdowns including all carrying costs, feed costs (winter), revenue, and highlighted net income with cost of gain</done>
</task>

<task type="auto">
  <name>Task 3: Add Annual Projections and Credit Structure sections</name>
  <files>src/app/plan/[slug]/page.tsx</files>
  <action>
Add Annual Projections and Credit Structure sections after Winter Turn.

**Annual Projections section:**
- Section heading: "Annual Projections" with accent border-l-4
- Summary grid: grid md:grid-cols-3 gap-4 inside white card
- Metric cards (each: bg-gray-50 rounded-lg p-4 text-center):
  - Spring Net Total: annual.springTotal formatCurrencyWhole — with "Spring" label
  - Winter Net Total: annual.winterTotal formatCurrencyWhole — with "Winter" label
  - Annual Net Income: annual.annualNetIncome formatCurrencyWhole — emphasized: larger text, accent color if positive, red if negative
  - Total Revenue: annual.totalRevenue formatCurrencyWhole
  - Total Investment: annual.totalInvestment formatCurrencyWhole
- Footer note below grid: "Based on {config.head_count} head" in text-sm text-gray-500

**Credit Structure section:**
- Section heading: "Credit Structure" with accent border-l-4
- White card with two parts:

Part 1 — Key metrics in a row/grid (grid md:grid-cols-3 gap-4):
  - Line of Credit: config.loc_amount formatCurrencyWhole
  - Interest Rate: config.interest_rate_pct formatPercent
  - Capital Required: annual.totalInvestment formatCurrencyWhole

Part 2 — LOC Utilization visual:
  - Label: "LOC Utilization: {annual.locUtilization formatPercent}"
  - Progress bar: outer div (h-4 bg-gray-200 rounded-full), inner div (h-4 rounded-full) with width = min(locUtilization, 100)%
  - Bar color: green (#3a7d53) if under 80%, amber/yellow if 80-100%, red if over 100%
  - Below bar: "Remaining Capacity: {annual.locCapacityRemaining formatCurrencyWhole}" in text-sm
  - If utilization over 100%, show warning text in red: "Warning: Capital required exceeds line of credit"
  </action>
  <verify>npm run build passes. Annual Projections shows aggregated financials in grid. Credit Structure shows LOC details with colored utilization bar.</verify>
  <done>Annual Projections displays 5 aggregated financial metrics. Credit Structure shows LOC details with visual utilization bar that changes color based on usage level.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Operation Overview shows operator details in two-column layout
- [ ] Spring Turn table shows complete per-head financials with carrying cost breakdown
- [ ] Winter Turn table shows financials including feed cost breakdown
- [ ] Annual Projections shows 5 aggregated totals with head count note
- [ ] Credit Structure shows LOC details with colored utilization bar
- [ ] All values properly formatted (currency, weights, percentages)
- [ ] Net income values show green/red coloring
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All five sections render with real calculated data from Supabase
- Tables are professionally styled with clear financial hierarchy
- Numbers properly formatted using formatters.ts utilities
- LOC utilization bar provides visual indicator with color thresholds
- Sections flow logically for banker audience
</success_criteria>

<output>
After completion, create `.planning/phases/06-public-plan-pages/06-02-SUMMARY.md`
</output>
