---
phase: 13-bank-version-management-ux
plan: 01
type: execute
depends_on: []
files_modified: [src/app/admin/versions/page.tsx, src/app/api/admin/versions/[id]/route.ts, src/app/admin/versions/[id]/edit/page.tsx, src/app/admin/versions/new/page.tsx]
---

<objective>
Polish the bank version list, create, and edit pages for a smoother admin workflow matching the quality established in Phase 11 (config form UX) and Phase 12 (dashboard & navigation).

Purpose: The bank version management pages were built in Phase 4 as functional MVP. Phase 13 brings them up to the same polish level as the recently improved config form and dashboard — loading skeletons, better feedback, preview links, and reactivation support.
Output: Polished bank version list with skeletons, success messages, public plan links, reactivate/deactivate toggle, date display. Improved forms with direct fetch-by-ID and slug preview URL.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/04-bank-version-mgmt/04-02-SUMMARY.md
@.planning/phases/11-admin-config-form-ux/11-01-SUMMARY.md
@.planning/phases/12-admin-dashboard-navigation/12-01-SUMMARY.md

# Source files to modify:
@src/app/admin/versions/page.tsx
@src/app/admin/versions/new/page.tsx
@src/app/admin/versions/[id]/edit/page.tsx
@src/app/api/admin/versions/[id]/route.ts

# Reference files for patterns:
@src/app/admin/page.tsx
@src/app/admin/config/page.tsx

**Established patterns:**
- Loading skeletons: animate-pulse placeholder divs during API fetch (Phase 12)
- Breadcrumb navigation: already in layout.tsx, segment labels for "versions", "new", "edit" already mapped
- Link components: Next.js Link for all internal navigation (Phase 12)
- Sticky save bar with unsaved changes detection (Phase 11 — not needed here, forms are simpler)

**Constraining decisions:**
- Phase 4: Soft delete via is_active flag (API supports PATCH is_active=true for reactivation)
- Phase 4: URL success redirect pattern (?success=created|updated) — currently sent but never consumed
- Phase 4: Edit form does not auto-regenerate slug (preserves URLs)
- Phase 12: Dashboard already shows "View Plan" links to /plan/{slug} — list page should match
</context>

<tasks>

<task type="auto">
  <name>Task 1: Polish bank versions list page</name>
  <files>src/app/admin/versions/page.tsx</files>
  <action>
  Update the list page with these specific improvements:

  1. **Loading skeletons** — Replace the plain text "Loading versions..." with animate-pulse skeleton placeholders matching the Phase 12 dashboard pattern. Show a skeleton table with 3 placeholder rows (gray bars for each column).

  2. **URL param success messages** — Read `?success=created|updated` from URL search params on mount using `useSearchParams()`. Display a green success banner ("Bank version created successfully" / "Bank version updated successfully") and clear the URL param after display. This fixes the broken feedback loop where create/edit pages redirect with success params that are never read.

  3. **Public plan preview link** — Add a "View Plan" link to each row's actions column that links to `/plan/{slug}` (opens in new tab with target="_blank"). Use the accent color text style matching the dashboard's "View Plan" links. Only show for active versions.

  4. **Reactivate button for inactive versions** — Currently inactive versions show no actions except Edit. Add a "Reactivate" button (green text, same style as other action links) that calls PATCH `/api/admin/versions/{id}` with `{ is_active: true }`. Include a confirmation dialog ("Reactivate {bank_name}? This will make the plan publicly available again."). After success, refresh the list and show a success message.

  5. **Created date column** — Add a "Created" column after Status showing the created_at date formatted as a short readable date (e.g., "Feb 9, 2026"). Use `new Date(version.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })`.

  6. **Consistent action ordering** — Actions column should show: View Plan (active only) | Edit | Deactivate (active) or Reactivate (inactive).

  Do NOT change the overall page structure or component architecture. Keep the same state management pattern. Only add the improvements above.
  </action>
  <verify>npm run build passes without errors; visually inspect that list page shows skeleton loading, success messages from URL params, view plan links, reactivate button for inactive versions, and date column</verify>
  <done>List page has loading skeletons, reads URL success params, shows public plan links, supports reactivation, and displays created dates</done>
</task>

<task type="auto">
  <name>Task 2: Add GET-by-ID endpoint and polish form pages</name>
  <files>src/app/api/admin/versions/[id]/route.ts, src/app/admin/versions/[id]/edit/page.tsx, src/app/admin/versions/new/page.tsx</files>
  <action>
  **API: Add GET handler to [id]/route.ts**

  Add a GET export to the existing `src/app/api/admin/versions/[id]/route.ts` file that:
  - Queries `plan_versions` by ID using `.eq('id', id).single()`
  - Returns the version object as JSON (200)
  - Returns 404 with `{ error: 'Version not found' }` if not found
  - Returns 500 on database errors
  - Follow the same pattern as the existing PATCH/DELETE handlers for error handling

  **Edit page: Use direct GET by ID**

  Update `src/app/admin/versions/[id]/edit/page.tsx`:
  - Change `fetchVersion()` to call `GET /api/admin/versions/${versionId}` instead of fetching all versions and filtering client-side
  - Remove the array filtering logic (`versions.find(v => v.id === versionId)`)
  - Parse the single version object directly from the response
  - Replace plain text "Loading version..." with skeleton placeholder (animate-pulse card matching the form shape — a card outline with gray bars for the form sections)

  **Both forms: Add slug preview URL**

  On both create and edit forms, add a preview line below the slug input that shows the full public URL:
  - Format: `piercelandandcattle.com/plan/{slug}` displayed in small gray text with a monospace font for the slug portion
  - On create form: Updates live as slug auto-generates from bank name
  - On edit form: Shows current slug URL, updates if slug is manually edited
  - Only show when slug field has a valid value (matches the slug pattern)
  - Do NOT make it a clickable link on create (version doesn't exist yet). On edit, make it a clickable link opening in new tab.

  Do NOT refactor the shared form code between create and edit — they work fine as separate pages. Only make the specific changes above.
  </action>
  <verify>npm run build passes without errors; edit page loads version data via direct GET by ID call; both forms show slug preview URL</verify>
  <done>Edit page fetches by ID directly (not all versions), both forms show public URL preview below slug field, edit page has loading skeleton</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Polished bank version management pages: list with skeletons/success messages/plan links/reactivation/dates, forms with direct fetch and slug URL preview</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/admin/versions
    3. Verify: Loading shows skeleton table (not plain text)
    4. Verify: Table has columns: Bank Name, Slug, Status, Created, Overrides, Actions
    5. Verify: Active versions show "View Plan | Edit | Deactivate" in actions
    6. Verify: Inactive versions show "Edit | Reactivate" in actions
    7. Click "Create New Bank Version"
    8. Type a bank name — verify slug auto-generates AND preview URL appears below slug field
    9. Submit the form — verify redirect to list with green success message
    10. Click "Edit" on a version — verify form loads directly (not fetching all), shows loading skeleton, and has slug URL preview
    11. If any inactive versions exist, click "Reactivate" and confirm it works
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] List page shows skeleton loading placeholders
- [ ] URL success params display green banners on list page
- [ ] Each active version row has "View Plan" link to /plan/{slug}
- [ ] Inactive versions can be reactivated from the list
- [ ] Created date displays in list table
- [ ] Edit page fetches single version by ID (not all versions)
- [ ] Both forms show public URL preview below slug field
- [ ] No TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Bank version management UX matches quality level of admin config (Phase 11) and dashboard (Phase 12)
- Phase 13 complete — v1.1 milestone finished
  </success_criteria>

<output>
After completion, create `.planning/phases/13-bank-version-management-ux/13-01-SUMMARY.md`
</output>
