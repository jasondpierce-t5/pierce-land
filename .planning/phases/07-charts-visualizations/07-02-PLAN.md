---
phase: 07-charts-visualizations
plan: 02
type: execute
---

<objective>
Integrate all 5 chart components into the public plan page and verify visual quality.

Purpose: Charts appear inline with their corresponding data sections, creating a polished visual presentation for bankers.
Output: Updated /plan/[slug] page with charts rendered below each data section. Phase 7 complete.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-charts-visualizations/07-01-SUMMARY.md

@src/app/plan/[slug]/page.tsx
@src/lib/types.ts
@src/lib/plan-data.ts
@src/components/charts/chart-config.ts
@src/components/charts/ScenarioChart.tsx
@src/components/charts/BreakevenChart.tsx
@src/components/charts/CostBreakdownChart.tsx
@src/components/charts/HaySensitivityChart.tsx
@src/components/charts/PurchaseSensitivityChart.tsx

**Tech stack available:** chart.js, react-chartjs-2 (from 07-01)
**Established patterns:** Server component passes serializable data to 'use client' chart components
**Constraining decisions:**
- [06-02]: Inline helper components (TableRow, etc.) within page.tsx
- [06-03]: Section order: Operation Overview → Spring Turn → Winter Turn → Annual Projections → Credit Structure → Scenario Analysis → Breakeven → Worst-Case → Hay Sensitivity → Purchase Sensitivity → Disclaimer
- [PROJECT.md]: Professional design matching primary/accent/green palette
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate all chart components into plan page</name>
  <files>src/app/plan/[slug]/page.tsx</files>
  <action>
Import all 5 chart components at top of page.tsx.

Insert charts BELOW their corresponding data table/section with consistent spacing (mt-6 within the same section wrapper):

1. **ScenarioChart** — Below the Scenario Analysis table
   - Pass: `scenarios={scenarios}`

2. **BreakevenChart** — Below the Breakeven Analysis cards
   - Pass: `springBreakeven={breakeven.springBreakeven}`, `winterBreakeven={breakeven.winterBreakeven}`, `currentMarketPrice={config.market_price_850lb}`

3. **CostBreakdownChart (Spring)** — Below the Spring Turn section
   - Pass title="Spring Turn Cost Breakdown"
   - Build segments array from spring TurnResult + config fields:
     - "Purchase Cost" → spring.purchaseCost
     - "Interest" → spring.interestCost
     - "Death Loss" → spring.deathLoss
     - "Health" → config.spring_health_cost_per_head
     - "Freight" → config.spring_freight_in_per_head + config.spring_freight_out_per_head
     - "Other" → config.spring_mineral_cost_per_head + config.spring_lrp_premium_per_head + config.spring_marketing_commission_per_head + config.spring_misc_per_head

4. **CostBreakdownChart (Winter)** — Below the Winter Turn section
   - Pass title="Winter Turn Cost Breakdown"
   - Build segments array similarly, plus "Feed Costs" → winter.totalFeedCost

5. **HaySensitivityChart** — Below the Hay Price Sensitivity table
   - Pass: `data={haySensitivity}`, `currentHayPrice={config.hay_price_per_bale}`

6. **PurchaseSensitivityChart** — Below the Purchase Price Sensitivity table
   - Pass: `data={purchaseSensitivity}`, `currentPurchasePrice={config.market_price_500lb}`

Each chart should be wrapped in the same card styling as surrounding content:
`<div className="mt-6 bg-white shadow-sm rounded-lg p-6">` with a small heading like "Visual Summary" or just the chart.

Since page.tsx is a server component and chart components are 'use client', React handles the boundary automatically — no special wrappers needed. Just import and use. The data passed as props is all serializable numbers/objects.

Avoid: Do NOT convert page.tsx to a client component. Keep it as a server component. Chart components handle their own 'use client' boundary.
  </action>
  <verify>npm run build passes. No TypeScript errors. All 6 chart instances present in page.tsx (2 CostBreakdown + 4 others).</verify>
  <done>All 5 chart component types (6 instances) integrated into plan page below their corresponding data sections. Build passes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>All business charts integrated into the public plan page — scenario bars, breakeven comparison, cost doughnut charts, and sensitivity line charts</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/plan/[your-test-slug] (use an active plan slug)
    3. Scroll through the full plan page and verify:
       a. Scenario Analysis section has a grouped bar chart below the table (Low=red, Mid=gray, High=green)
       b. Breakeven Analysis section has a bar chart comparing breakeven vs market price
       c. Spring Turn section has a doughnut chart showing cost breakdown
       d. Winter Turn section has a doughnut chart showing cost breakdown (includes feed costs)
       e. Hay Sensitivity section has a line chart with current price highlighted
       f. Purchase Sensitivity section has a line chart with current price highlighted
    4. Verify charts use project brand colors (dark green, accent brown/orange, medium green)
    5. Verify charts are responsive — resize browser window to confirm they adapt
    6. Check that negative values display correctly (bars below zero line in scenario chart)
    7. Verify no console errors related to Chart.js or hydration
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] All 6 chart instances render on plan page
- [ ] Charts use project brand colors
- [ ] Charts are responsive
- [ ] No console errors or hydration mismatches
- [ ] Human verification approved
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Charts enhance the business plan presentation
- Phase 7 complete
  </success_criteria>

<output>
After completion, create `.planning/phases/07-charts-visualizations/07-02-SUMMARY.md`
</output>
