---
phase: 07-charts-visualizations
plan: 01
type: execute
---

<objective>
Install Chart.js with React wrapper and create all 5 business chart components as reusable 'use client' modules.

Purpose: Build the chart component library that Phase 7 Plan 02 will integrate into the public plan page. Charts provide visual impact for banker presentations.
Output: chart-config.ts registration file + 5 chart components (ScenarioChart, BreakevenChart, CostBreakdownChart, HaySensitivityChart, PurchaseSensitivityChart)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-financial-calculations/05-03-SUMMARY.md
@.planning/phases/06-public-plan-pages/06-01-SUMMARY.md
@.planning/phases/06-public-plan-pages/06-03-SUMMARY.md

@src/lib/types.ts
@src/lib/plan-data.ts
@src/app/plan/[slug]/page.tsx

**Tech stack available:** Next.js 14, TypeScript, Tailwind CSS, Supabase, react-chartjs-2 (to install)
**Established patterns:** Pure calculation functions, server component data fetching, isValid() formatter guards
**Constraining decisions:**
- [05-02]: No rounding at calculation level — chart components format display values
- [06-01]: fetchPlanData returns PlanPageData with all calculation results (scenarios, haySensitivity, purchaseSensitivity, breakeven, spring, winter, annual)
- [06-01]: Accounting format ($X) for negative currency
- [PROJECT.md]: Color palette — primary #1a3a2a, accent #c4872a, green #3a7d53
- [PROJECT.md]: Chart.js specified as the visualization library (non-negotiable)

**Chart.js integration notes (from discovery):**
- Install: `npm i chart.js react-chartjs-2`
- Must use `'use client'` directive on all chart components (Canvas/DOM APIs)
- Must register Chart.js components explicitly for tree-shaking
- Server component (page.tsx) passes serializable data as props to client chart components
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Chart.js packages and create chart configuration</name>
  <files>package.json, src/components/charts/chart-config.ts</files>
  <action>
1. Install packages: `npm install chart.js react-chartjs-2`
2. Create `src/components/charts/chart-config.ts`:
   - Import and register ALL needed Chart.js components: CategoryScale, LinearScale, BarElement, PointElement, LineElement, ArcElement, Title, Tooltip, Legend, Filler
   - Export project color palette constants matching Tailwind config:
     - PRIMARY = '#1a3a2a' (dark green)
     - ACCENT = '#c4872a' (warm brown/orange)
     - GREEN = '#3a7d53' (medium green)
     - RED = '#dc2626' (for losses — matches Tailwind red-600)
     - GRAY = '#6b7280' (for neutral — matches Tailwind gray-500)
   - Export LOW/MID/HIGH scenario colors: RED for low, GRAY for mid, GREEN for high
   - Export a shared `defaultOptions` object with: responsive: true, maintainAspectRatio: false, font family Inter
   - Do NOT use dynamic imports or next/dynamic — direct import with 'use client' is sufficient

Avoid: Do not register ChartJS globally in a useEffect — register at module level (top of file). This is the standard pattern for react-chartjs-2.
  </action>
  <verify>npm run build passes — no TypeScript errors. chart.js and react-chartjs-2 appear in package.json dependencies.</verify>
  <done>chart.js + react-chartjs-2 in dependencies. chart-config.ts exports color constants and default options. Chart.js components registered.</done>
</task>

<task type="auto">
  <name>Task 2: Create ScenarioChart and BreakevenChart components</name>
  <files>src/components/charts/ScenarioChart.tsx, src/components/charts/BreakevenChart.tsx</files>
  <action>
**ScenarioChart.tsx** — Grouped bar chart comparing Low/Mid/High scenarios:
- 'use client' directive at top
- Import { Bar } from 'react-chartjs-2' and colors from chart-config
- Props: `{ scenarios: { low: ScenarioResult; mid: ScenarioResult; high: ScenarioResult } }`
- Import ScenarioResult type from @/lib/types
- X-axis labels: ['Spring Net/Head', 'Winter Net/Head', 'Annual Net']
- 3 datasets: Low (RED), Mid (GRAY), High (GREEN) — each with the corresponding values
- Annual Net values are whole-operation (not per-head) — use scenarios.low.annualNet etc.
- Options: responsive, maintainAspectRatio false, scales.y.ticks.callback formats as currency
- Wrap in a div with fixed height (h-72) so chart has consistent sizing
- Handle negative values naturally (bars go below zero line)

**BreakevenChart.tsx** — Bar chart showing breakeven prices vs current market:
- 'use client' directive at top
- Import { Bar } from 'react-chartjs-2' and colors from chart-config
- Props: `{ springBreakeven: number; winterBreakeven: number; currentMarketPrice: number }`
- X-axis labels: ['Spring Turn', 'Winter Turn']
- 2 datasets: "Breakeven Price" (ACCENT bars) and "Market Price" (GREEN bars, repeated for both)
- This visually shows whether market price exceeds breakeven (profitable)
- Options: responsive, scales.y.ticks.callback formats as $/cwt, legend at top
- Wrap in div with h-64

Avoid: Do NOT import the full chart-config registration in each component — import it once in chart-config.ts (side effect import). Each component just imports colors/options from chart-config.
  </action>
  <verify>npm run build passes with no TypeScript errors.</verify>
  <done>ScenarioChart and BreakevenChart compile. Both accept typed props and render Bar charts with project colors.</done>
</task>

<task type="auto">
  <name>Task 3: Create CostBreakdownChart, HaySensitivityChart, and PurchaseSensitivityChart</name>
  <files>src/components/charts/CostBreakdownChart.tsx, src/components/charts/HaySensitivityChart.tsx, src/components/charts/PurchaseSensitivityChart.tsx</files>
  <action>
**CostBreakdownChart.tsx** — Doughnut chart showing cost components:
- 'use client' directive at top
- Import { Doughnut } from 'react-chartjs-2' and colors from chart-config
- Props: `{ title: string; segments: { label: string; value: number }[] }`
  - Generic so it works for both spring and winter turn cost breakdowns
- Labels from segments[].label, data from segments[].value
- Use a palette of 5-6 muted professional colors (PRIMARY, ACCENT, GREEN, slate-400, sky-600, amber-500 hex values)
- Options: responsive, plugins.legend at bottom, plugins.tooltip.callbacks format values as currency
- Wrap in div with h-64
- Filter out zero-value segments to keep chart clean

**HaySensitivityChart.tsx** — Line chart showing hay price impact:
- 'use client' directive at top
- Import { Line } from 'react-chartjs-2' and colors from chart-config
- Props: `{ data: HaySensitivityPoint[]; currentHayPrice: number }`
- Import HaySensitivityPoint type from @/lib/types
- X-axis: hayPricePerBale values (formatted as currency)
- Y-axis: winterNetPerHead values
- Single line dataset in GREEN with point markers
- Highlight current hay price point with a larger ACCENT-colored point (use pointBackgroundColor array where matching index gets ACCENT, others get GREEN)
- Options: scales.y.ticks.callback formats as currency, scales.x.title "Hay Price/Bale"
- Wrap in div with h-64

**PurchaseSensitivityChart.tsx** — Line chart showing purchase price impact:
- 'use client' directive at top
- Import { Line } from 'react-chartjs-2' and colors from chart-config
- Props: `{ data: PurchaseSensitivityPoint[]; currentPurchasePrice: number }`
- Import PurchaseSensitivityPoint type from @/lib/types
- X-axis: purchasePriceCwt values (formatted as $/cwt)
- Y-axis: annualNetTotal values
- Single line dataset in PRIMARY with point markers
- Highlight current purchase price point with larger ACCENT-colored point (same pattern as HaySensitivityChart)
- Options: scales.y.ticks.callback formats as currency, scales.x.title "Purchase Price/CWT"
- Wrap in div with h-64

Avoid: Do NOT create barrel exports (index.ts) — direct imports keep the dependency tree clear.
  </action>
  <verify>npm run build passes with no TypeScript errors. All 5 chart components compile.</verify>
  <done>CostBreakdownChart, HaySensitivityChart, and PurchaseSensitivityChart compile. All 5 chart components created with typed props, project colors, and consistent sizing.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] chart.js and react-chartjs-2 in package.json dependencies
- [ ] 6 files exist in src/components/charts/ (1 config + 5 components)
- [ ] All components use 'use client' directive
- [ ] All components accept typed props matching src/lib/types.ts interfaces
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- 5 chart components ready for integration in 07-02
  </success_criteria>

<output>
After completion, create `.planning/phases/07-charts-visualizations/07-01-SUMMARY.md`
</output>
